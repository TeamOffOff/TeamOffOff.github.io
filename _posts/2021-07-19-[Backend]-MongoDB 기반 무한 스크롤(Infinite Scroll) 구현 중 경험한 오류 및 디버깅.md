---
layout: post
title: "[Backend] MongoDB 기반 무한 스크롤(Infinite Scroll) 구현 중 경험한 오류 및 디버깅"
author: "김소연"
date: 2021-07-19
background: ''
tags: python
---
 <br>

 ## STEP1. 페이지 구현 기법 선택

 표시할 콘텐츠가 많은 경우, 데이터 로드를 위한 UX 패턴을 고민해보아야 합니다. 고려할 수 있는 디자인 패턴에는  
 1.페이징(Pagination), 2.무한 스크롤(Infinite Scroll), 3.하이브리드(Hybrid)가 있습니다.  
 각 패턴은 서로 다른 장단점을 가지므로 제공하는 서비스의 특징, 웹/모바일 어플 여부 등을 기준으로 선택해야합니다.  
  
 1. 페이징(Pagination)
-  페이징은 콘텐츠를 별도의 페이지로 나누는 사용자 인터페이스 패턴을 말합니다.  
-  사용자가 페이지를 하단으로 스크롤하면 숫자 행을 제공합니다.  
-  각 해당 숫자는 사이트 또는 앱의 페이지를 나타냅니다.  

 2. 무한 스크롤(Infinite Scroll)  
-  무한 스크롤은 사용자가 페이지를 아래로 스크롤할 때 자동으로 페이지가 새로 고침 되는 패턴입니다.  
-  이 경우 사용자가 하단에 도달하면 더 많은 데이터가 새로고침 되므로 사용자는 Footer에 도달하기 어렵게 됩니다.  

 3. 하이브리드(Hybrid)  
-  하이브리드는 '더보기'버튼을 구현함으로써 페이징과 무한 스크롤을 혼합한 형태라고 볼 수 있습니다.  
-  사용자가 하단에 도달하면 더보기 버튼을 보여주고, 사용자가 이를 클릭하는 경우에만 페이지가 새로 고침 됩니다.  

 ### 무한 스크롤 선택 이유  
 커뮤니티 모바일 애플리케이션의 경우 무한 스크롤 방식이 주로 사용됩니다.  
 1. 커뮤니티 서비스는 사용자가 오래 머물 수 있도록 해야하며, 
 2. 모바일 애플리케이션의 경우 클릭 보다는 스크롤이 더 간편하기 때문입니다.  


 <br>
 <br>

 ## STEP2. 무한 스크롤 구현
 무한 스크롤을 구현하기 위해서는,

 클라이언트는 사용자의 스크롤을 감지해야하고, 사용자가 하단에 도달하는 경우 서버에 새로운 페이지를 요청해야합니다.
 서버는 해당 요청에 따라 새로운 데이터를 보내주어야 합니다.  
 <br> 

 새로운 데이터를 보내주는 방식으로 skip과 limit를 동시에 활용할 수 있지만,  
 skip의 경우 모든 데이터를 불러오기 때문에 성능 상 문제가 발생할 수 있습니다.  
 ```python
 users = db.users.find({}).skip((page-1)*20).limit(20)
 ```

 위와 같은 방식 대신, 이전에 불러온 데이터 "이외의" 데이터만 보내주는 방식을 사용할 수 있습니다.  
  ```MongoDB```의 경우 데이터 저장 시 _id가 자동적으로 생성됩니다. _id는 단순 string이 아니고, 유닉스 시간을 포함하여 구성됩니다.  
  따라서 클라이언트와 서버가 주고받는 도큐먼트(document) 중 마지막 도큐먼트의 _id를 기준으로 사용할 수 있습니다.  

<br>
 이를 적용하면 다음과 같이 작성할 수 있습니다.  

 ```python
 users = db.users.find({'_id'>last_id}).limit(20)
 ```

 정리하자면, 
 - 클라이언트는 지난 페이지의 마지막 도큐멘트의 _id와 함께 새로운 페이지를 요청하고,  
 - 서버는 _id를 기준으로 이전에 불러온 데이터 "이외의" 데이터를 찾아서 보내주면 됩니다.  
  

<br>
<br>

 ## STEP3. 오류 및 디버깅
 ### document sorting 시 TypeError

 ### _id return 시 TypeError
 1. jsonify
 2. json.dumps
 3. for문을 활용해 _id를 str로 변환
 ### find 결과 return 시 TypeError

 ### 클라이언트가 보낸 string type의 _id
